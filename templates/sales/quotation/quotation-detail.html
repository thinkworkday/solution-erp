{% extends 'base.html' %}
{% load static %}
{% load jsignature_filters %}
{% block page-title %}Quotation Detail{% endblock%}
{% block css %}
    <link href="{% static 'assets/libs/select2/css/select2.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'assets/libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}" rel="stylesheet">
    <!-- DataTables -->
    <link href="{% static 'assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
    <!-- Responsive datatable examples -->
    <link href="{% static 'assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" /> 
    <!-- Handsontable -->
    <script src=
"https://cdn.jsdelivr.net/npm/handsontable@8.2.0/dist/handsontable.full.min.js">
    </script>
      
    <link href=
"https://cdn.jsdelivr.net/npm/handsontable@8.2.0/dist/handsontable.full.min.css"
        rel="stylesheet" media="screen"> 
    <style>
        .avatar-input {
            position: relative;
            overflow: hidden;
            padding: 5px;
        }
        .signature-img {
            /* height: 7rem; */
            width: auto;
        }
        .avatar-input .avatar-input-icon {
            position: absolute;
            top: 0;
            display: flex;
            width: 100%;
            height: 100%;
            transition: all ease .2s;
            opacity: 0;
            color: #fff;
            background: rgba(0,0,0,.37);
            justify-content: center;
            align-items: center;
        }
        .avatar-input .avatar-file-picker {
            position: absolute;
            z-index: 2;
            width: 1px;
            height: 1px;
            margin: 0;
            opacity: 0;
        }
        #newSearchPlace div.dataTables_filter {
            text-align: right;
            padding-top: 5px;
        }
        #newSearchPlace div.dataTables_filter label {
            font-weight: normal;
            white-space: nowrap;
            text-align: left;
        }
        #newSearchPlace div.dataTables_filter input {
            margin-left: 0.5em;
            margin-right: 0;
            display: inline-block;
            width: auto;
        }
        #newfilePlace div.dataTables_filter {
            text-align: right;
            padding-top: 5px;
        }
        #newfilePlace div.dataTables_filter label {
            font-weight: normal;
            white-space: nowrap;
            text-align: left;
        }
        #newfilePlace div.dataTables_filter input {
            margin-left: 0.5em;
            margin-right: 0;
            display: inline-block;
            width: auto;
        }
    </style>
{% endblock %}
{% block content %}
<div class="container-fluid">
    <!-- start page title -->
    <div class="row">
        <div class="col-sm-6">
            <div class="page-title-box">
                <h4>Quotation Details
                </h4>
                    <ol class="breadcrumb m-0">
                        <li class="breadcrumb-item"><a class="text-primary" href="{% url 'all_quotation' %}"><b>Quotation</b></a></li>
                        <li class="breadcrumb-item active">Quotation Details</li>
                    </ol>
                    
            </div>
        </div>
    </div>
    <!-- end page title -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link" style="padding-left: 30px;padding-right: 30px;" id="qdetailtab" data-bs-toggle="tab" href="#qdetails" role="tab">
                                <span class="d-block d-sm-none">DT</span>
                                <span class="d-none d-sm-block">Details</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" style="padding-left: 30px;padding-right: 30px;" id="qitemtab" href="#qitems" role="tab">
                                <span class="d-block d-sm-none">IT</span>
                                <span class="d-none d-sm-block">Items</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" style="padding-left: 30px;padding-right: 30px;" id="qfiletab" href="#qfiles" role="tab">
                                <span class="d-block d-sm-none">FL</span>
                                <span class="d-none d-sm-block">Files</span>
                            </a>
                        </li>
                    </ul>
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div class="tab-pane p-3" id="qdetails" role="tabpanel">
                            <form data-parsley-validate id="QuotationDetailForm">
                                {% csrf_token %}
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="justify-content-start d-flex">
                                            {% if quotation.flag %}
                                            <div class="button-items mb-3">
                                                <a href="javascript:void(0);" id="quotupdate" class="align-middle btn-lg btn-outline-primary"><i class="fas fa-pencil-alt mr-2"></i></a>
                                                <a href="javascript:void(0);" id="quotcancel" class="align-middle btn-lg btn-outline-danger"><i class="ion ion-ios-close-circle mr-2"></i></a>
                                                <a href="javascript:void(0);" id="quotdelete" class="align-middle btn-lg btn-outline-danger"><i class="far fa-trash-alt mr-2"></i></a>
                                                
                                                <button type="button" id="quotsave" class="btn btn-primary btn-sm" style="margin-bottom: 0px!important;"><i class="mdi mdi-content-save-move"></i> Save</button>
                                                <button type="button" id="quotsaveandoverwrite" class="btn btn-primary btn-sm" style="margin-bottom: 0px!important;"><i class="mdi mdi-content-save-move"></i> Save & Create Revision</button>
                                               
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="justify-content-end d-flex">
                                            <div class="dropdown d-inline-block">
                                                <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                        Print <i class="mdi mdi-chevron-down"></i>
                                                    </a>
                
                                                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                    <a class="dropdown-item" href="{% url 'export_quotation_pdf' value=quote %}">PDF</a>
                                                    <!-- a class="dropdown-item" href="{% url 'export_quotation_excel' value=quote %}">Excel</a -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <hr class="my-auto flex-grow-1 mt-1 mb-1" style="height:2px;">
                                <div id="text_error" class="alert alert-danger alert-dismissible fade show mb-0" style="display: none;" role="alert">
                                </div>
                                <div class="row p-3" >
                                    <div class="col-md-7">
                                        <div class="row pt-2">
                                            <div class="mb-3">
                                                <label class="form-label" for="company_name">Company</label>
                                                <select class="form-control select2" id="company_name" name="company_name" required>
                                                    <option value="">Select the Company</option>
                                                    {% for company in companies %}
                                                        <option value="{{company.id}}" {% if company.id == quotation.company_name.id %}selected{% endif %}>{{company.name}}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="mb-3">
                                                <label class="form-label" for="address">Address</label>
                                                <input type="text" class="form-control" id="address" name="address" style="height:38px;" value="{{quotation.address|default_if_none:''}}" required readonly>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="contact_person">Contact Person</label>
                                                    <select class="form-control select2" id="contact_person" name="contact_person" required>
                                                        <option value="">Select the Contacts</option>
                                                        {% for contact in contacts %}
                                                            <option value="{{contact.id}}" {% if contact.id == quotation.contact_person.id %}selected{% endif %}>{{contact.contact_person}}</option>
                                                        {% endfor %}
                                                    </select>
        
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="email">Email</label>
                                                    <input type="email" class="form-control" id="email" name="email" style="height:38px;" value="{{quotation.email|default_if_none:''}}" required>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="tel">Tel</label>
                                                    <input type="text" class="form-control" id="tel" name="tel" style="height:38px;" value="{{quotation.tel|default_if_none:''}}" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="fax">Fax</label>
                                                    <input type="text" class="form-control" id="fax" name="fax" style="height:38px;" value="{{quotation.fax|default_if_none:''}}" required>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="mb-3">
                                                <label class="form-label" for="qre">Subject</label>
                                                <textarea class="form-control" id="qre" name="qre" rows="5" required>{{quotation.RE|default_if_none:''}}</textarea>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="mb-3">
                                                <label class="form-label" for="note">Note</label>
                                                <textarea class="form-control" id="note" name="note" rows="5">{{quotation.note|default_if_none:''}}</textarea>
                                            </div>
                                        </div>
                                        <div class="mt-3 mb-3 row">
                                            <div class="col-md-6">
                                                <label for="sale_type" class="form-label">Sales Type:</label>
                                                <select class="form-control select2" id="sale_type" name="sale_type" required>
                                                    <option value="Project" {% if quotation.sale_type == "Project" %}selected{% endif %}>Project</option>
                                                    <option value="Maintenance" {% if quotation.sale_type == "Maintenance" %}selected{% endif %}>Maintenance</option>
                                                    <option value="Sales" {% if quotation.sale_type == "Sales" %}selected{% endif %}>Sales</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="sale_person" class="form-label">Sales Person:</label>
                                                <!-- <select class="form-control select2" id="sale_person" name="sale_person" required>
                                                    <option value="">Select Sale Person</option>
                                                    {% for saleperson in salepersons %}
                                                        <option value="{{saleperson.first_name}}"{% if saleperson.first_name == quotation.sale_person %} selected{% endif %}>{{saleperson.username}}</option>
                                                    {% endfor %}
                                                </select> -->
                                                <input type="text" class="form-control" id="sale_person" style="height:38px;" name="sale_person" value="{{request.user.username|default_if_none:''}}" readonly />
                                            </div>
                                        </div>
                                        <div class="mt-3 mb-3 row">
                                            <div class="col-md-6">
                                                <label for="po_no" class="form-label">PO No:</label>
                                                <input type="text" class="form-control" id="po_no" style="height:38px;" name="po_no" value="{{quotation.po_no|default_if_none:''}}" required />
                                                <ul id="po_no_valid" style="display: none;" class="parsley-errors-list filled">
                                                    <li class="parsley-required">
                                                        PO No is required to unlock status update.
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="date" class="form-label">Date:</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                                    <input type="text" class="form-control" id="date" style="height:38px;" name="date" data-date-format="dd M yyyy" data-provide="datepicker" data-date-autoclose="true" value="{{quotation.date|date:'d M, Y'|default_if_none:''}}" required>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3 mb-3 row">
                                            <div class="col-md-6">
                                                <label for="quo_validity" class="form-label">Quotation Validity (Days): </label>
                                                <input type="text" class="form-control" id="quo_validity" style="height:38px;" name="quo_validity" value="{{quotation.company_name.validity|default_if_none:''}}" readonly />
                                                
                                            </div>
                                            <div class="col-md-6">
                                                <label for="quo_terms" class="form-label">Payment Terms (Days):</label>
                                                <input type="text" class="form-control" id="quo_terms" style="height:38px;" name="quo_terms" value="{{quotation.company_name.payment|default_if_none:''}}" readonly />
                                            </div>
                                        </div>
                                        <div class="mb-3 row">
                                             
                                            <div class="col-md-6">
                                                <label class="form-label" for="estimated_mandays">Estimated Mandays</label>
                                                <input class="form-control js-number" id="estimated_mandays" style="height:38px;" name="estimated_mandays" value="{{quotation.estimated_mandays|default_if_none:''}}" required />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label" for="material_lead_time">Material Lead Time</label>
                                                <select class="form-control select2" id="material_lead_time" name="material_lead_time">
                                                    <option value="">Select ..</option>
                                                    <option value="NA" {% if quotation.material_leadtime == "NA" %}selected{% endif %}>NA</option>
                                                    <option value="TBA" {% if quotation.material_leadtime == "TBA" %}selected{% endif %}>TBA</option>
                                                    <option value="Ex-stock" {% if quotation.material_leadtime == "Ex-stock" %}selected{% endif %}>Ex-stock</option>
                                                    <option value="Ex-stock or 6 to 8 weeks" {% if quotation.material_leadtime == "Ex-stock or 6 to 8 weeks" %}selected{% endif %}>Ex-stock or 6 to 8 weeks</option>
                                                    <option value="Ex-stock or 8 to 12 weeks" {% if quotation.material_leadtime == "Ex-stock or 8 to 12 weeks" %}selected{% endif %}>Ex-stock or 8 to 12 weeks</option>
                                                    <option value="Ex-stock or 12 to 16 weeks" {% if quotation.material_leadtime == "Ex-stock or 12 to 16 weeks" %}selected{% endif %}>Ex-stock or 12 to 16 weeks</option>
                                                    <option value="3 to 4 weeks" {% if quotation.material_leadtime == "3 to 4 weeks" %}selected{% endif %}>3 to 4 weeks</option>
                                                    <option value="6 to 8 weeks" {% if quotation.material_leadtime == "6 to 8 weeks" %}selected{% endif %}>6 to 8 weeks</option>
                                                    <option value="8 to 12 weeks" {% if quotation.material_leadtime == "8 to 12 weeks" %}selected{% endif %}>8 to 12 weeks</option>
                                                    <option value="12 to 16 weeks" {% if quotation.material_leadtime == "12 to 16 weeks" %}selected{% endif %}>12 to 16 weeks</option>
                                                    <option value="16 to 20 weeks" {% if quotation.material_leadtime == "16 to 20 weeks" %}selected{% endif %}>16 to 20 weeks</option>
                                                    
                                                    
                                                </select>
                                            </div>
                                             
                                            
                                        </div>
                                        <div class="mb-3 row">
                                            <div class="col-md-6">
                                                <label for="qtt_status" class="form-label">Status:</label>
                                                <select class="form-control select2" id="qtt_status" name="qtt_status" required>
                                                    <option value="">Select the Status</option>
                                                    <option value="Open" {% if quotation.qtt_status == "Open" %}selected{% endif %}>Open</option>
                                                    <option value="Awarded" {% if quotation.qtt_status == "Awarded" %}selected{% endif %}>Awarded</option>
                                                    <option value="Closed" {% if quotation.qtt_status == "Closed" %}selected{% endif %}>Closed</option>
                                                    <option value="Loss" {% if quotation.qtt_status == "Loss" %}selected{% endif %}>Loss</option>
                                                </select>
                                                
                                            </div> 
                                        </div>
                                    </div>
                                    <div class="col-md-1"></div>
                                    <div class="col-md-4">
                                        <div class="row pt-2 me-3 ms-3">
                                            <span class="badge bg-primary pt-3 pb-3 fst-italic" style="font-size: 18px!important;">QUOTATION NO.</span>
                                        </div>
                                        <div class="row mt-3 mb-3 me-5 ms-5">
                                            <input type="text" class="form-control fw-bold" id="qtt_id" style="text-align: center;padding-top: 10px;padding-bottom: 10px;font-size: 20px;height:38px;" name="qtt_id" value="{{quotation.qtt_id|default_if_none:''}}" required>
                                        </div>
                                    </div>
                                    
                                </div>
                            </form>
                            <hr>
                            <div class="row p-3 mt-3">
                                <div class="col-md-7">
                                    <form class="needs-validation" id="SignatureForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <div class="mb-3 row">
                                                    <label for="signature" class="form-label">Autorised's Signatures:</label>
                                                    <div class="justify-content-start d-flex">
                                                        <label class="avatar-input">
                                                            {% if request.user.signature %}
                                                            <img src="{{request.user.signature.url}}" alt="..." style="height: 95px"
                                                                class="img-thumbnail" style="border: 1px solid rgba(0,0,0,.37);">
                                                            {% else %}
                                                            <img src="{% static 'assets/images/logo.png' %}" alt="..."
                                                                class="img-thumbnail" style="border: 1px solid rgba(0,0,0,.37);">
                                                            {% endif %}
                                                            <!-- <span class="avatar-input-icon">
                                                                <i class="mdi mdi-upload mdi-24px"></i>
                                                            </span> -->
                                                            <!-- <input type="file" id="signature" name="signature" class="avatar-file-picker" > -->
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- div class="col-md-6">
                                                <div class="mb-3 row">
                                                    <label for="companystamp" class="form-label">Company Stamp:</label>
                                                    <div class="justify-content-start d-flex">
                                                        <label class="avatar-input">
                                                            <img src="{% static 'assets/images/logo.png' %}" alt="..."
                                                                    class="img-thumbnail" style="border: 1px solid rgba(0,0,0,.37);">
                                                            <span class="avatar-input-icon">
                                                                <i class="mdi mdi-upload mdi-24px"></i>
                                                            </span>
                                                            <input type="file" id="companystamp" name="companystamp" class="avatar-file-picker" >
                                                        </label>
                                                    </div>
                                                    
                                                </div>
                                            </div -->
                                            
                                        </div>
                                        <div class="mb-3 row">
                                            <div class="col-md-6">
                                                <label for="sname" class="col-form-label">Name:</label>
                                                <input class="form-control" type="text" style="height:38px;"  id="sname" name="sname" value="{{request.user.username|default_if_none:''}}"  readonly>
                                            </div>
                                            <!-- div class="col-md-6">
                                                <label for="sdate" class="col-form-label">Date:</label>
                                                <input type="text" class="form-control" style="height:38px;" id="sdate" name="sdate" value="{{signaturedata.signature_date|date:'d M, Y'|default_if_none:''}}" readonly required>
                                            </div -->
                                            
                                        </div>
                                        <!-- <div class="row">
                                            <div class="col-md-6">
                                                <div class="justify-content-start d-flex">
                                                    <a herf="javascript:void(0);" class="btn btn-primary signature_save w-25"><i class="mdi mdi-content-save-move"></i>  Save </a>
                                                </div>
                                            </div>
                                        </div> -->
                                    </form>
                                </div>
                                
                            </div>
                        </div>
                        <div class="tab-pane p-3" id="qitems" role="tabpanel">
                            <div id="example"></div>
                            <div class="controls">
                                <button id="load" class="button button--primary button--blue">Load data</button>&nbsp;
                                <button id="save" class="button button--primary button--blue">Save data</button>
                                <label>
                                  <input type="checkbox" name="autosave" id="autosave"/>
                                  Autosave
                                </label>
                            </div>
                            {% include hot_template %}
                            {% comment %} <div class="row">
                                <div class="mt-1 col-md-3">
                                    {% if quotation.flag %}
                                    {% if quotation.qtt_status == "Open" %}
                                    <button type="button" id="scopeadd" class="btn btn-primary btn-sm"><i class="mdi mdi-content-save-move"></i> Add</button>
                                    {% endif %}
                                    {% endif %}
                                </div>
                                <div class="mt-1 col-md-9">
                                    <div class="justify-content-end d-flex">
                                        <div id="newSearchPlace"></div>
                                    </div>
                                    
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table id="scopedatatable" class="table table-bordered align-middle dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th width="5%">SN</th>
                                            <th width="58%">Description</th>
                                            <th width="8%">QTY</th>
                                            <th width="8%">UOM</th>
                                            <th width="8%">UNIT PRICE(S$)</th>
                                            <th width="8%">AMT(S$)</th>
                                            <th width="5%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for scope in scope_list %}
                                        <tr>
                                            <td class="align-middle">{{scope.sn|default_if_none:""}}</td>
                                            <td class="align-middle">{{scope.description|wordwrap:80|linebreaksbr|default_if_none:""}}</td>
                                            {% if scope.qty == "0" %}
                                            <td class="align-middle">{{scope.qty|default_if_none:""}}</td>
                                            {% else %} 
                                            <td class="align-middle"></td>
                                            {% endif %}
                                            <td class="align-middle">{{scope.uom|default_if_none:""}}</td>
                                            <td class="align-middle">{{scope.unitprice|default_if_none:""}}</td>
                                            <td class="align-middle">{{scope.amount|default_if_none:"--"}}</td>
                                            <td class="align-middle">
                                                {% if quotation.flag %}
                                                {% if quotation.qtt_status == "Open" %}
                                                
                                                <a href="javascript:void(0);" onclick="updatescope('{{scope.id}}')" class="btn btn-outline-primary btn-sm edit" title="Edit">
                                                    <i class="fas fa-pencil-alt"></i>
                                                </a>
                                                
                                                
                                                <a href="javascript:void(0);" onclick="deletescope('{{scope.id}}')" class="btn btn-outline-danger btn-sm delete" title="Delete">
                                                    <i class="far fa-trash-alt"></i>
                                                </a>
                                                {% endif %}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    {% if scope_list %}
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="align-middle">Total</td>
                                        <td class="align-middle">$ {{subtotal|floatformat:2}}</td> 
                                        <td></td>
                                            
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="align-middle">GST 7%</td>
                                        <td class="align-middle">$ {{gst|floatformat:2}}</td>
                                        <td></td>
                                                
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="align-middle">Final Total</td>
                                        <td class="align-middle">$ {{total_detail|floatformat:2}}</td> 
                                        <td></td>
                                            
                                    </tr>
                                    {% endif %}
                                    
                                    </tbody>
                                </table>
                            </div> {% endcomment %}
                        </div>
                        <div class="tab-pane p-3" id="qfiles" role="tabpanel">
                            <div class="row">
                                <div class="mt-1 col-md-3">
                                    {% if quotation.flag %}
                                    {% if quotation.qtt_status == "Open" %}
                                    <button type="button" id="fileadd" class="btn btn-primary btn-sm">
                                        <i class="mdi mdi-content-save-move"></i> Add
                                    </button>
                                    {% endif %}
                                    {% endif %}
                                </div>
                                <div class="mt-1 col-md-9">
                                    <div class="justify-content-end d-flex">
                                        <div id="newfilePlace"></div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table id="filedatatable" class="table table-bordered align-middle dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>SN</th>
                                            <th>Name</th>
                                            <th>Document</th>
                                            <th>Uploaded By</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for file_l in file_list %}
                                            <tr>
                                                <td class="align-middle">{{forloop.counter}}</td>
                                                <td class="align-middle">{{file_l.name|default_if_none:""}}</td>
                                                <td class="align-middle">
                                                    {{file_l.document|cut:'file/'|default_if_none:""}}
                                                </td>
                                                <td class="align-middle">{{file_l.user.username|default_if_none:""}}</td>
                                                <td class="align-middle">
                                                    {% if quotation.flag %}
                                                    {% if quotation.qtt_status == "Open" %}
                                                    <a href="javascript:void(0);" onclick="updatefile('{{file_l.id}}')" class="btn btn-outline-primary btn-sm edit" title="Edit">
                                                        <i class="fas fa-pencil-alt"></i>
                                                    </a>
                                                    {% endif %}
                                                    {% endif %}
                                                    {% if file_l.document %}
                                                    <a href="{{file_l.document.url}}" class="btn btn-outline-primary btn-sm edit" download title="Download">
                                                        <i class="mdi mdi-arrow-down-bold"></i>
                                                    </a>
                                                    {% endif %}
                                                    {% if quotation.flag %}
                                                    {% if quotation.qtt_status == "Open" %}
                                                    <a href="javascript:void(0);" onclick="deletefile('{{file_l.id}}')" class="btn btn-outline-danger btn-sm delete" title="Delete">
                                                        <i class="far fa-trash-alt"></i>
                                                    </a>
                                                    {% endif %}
                                                    {% endif %}
                                                </td>
                                                
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>
<!--Scope modal content -->
<div id="scopemodal" class="modal fade" role="dialog" aria-labelledby="scopeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="head_title_item">Add Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <div class="modal-body" id="manage_info">
                <form class="needs-validation p-3" id="ScopeForm">
                    {% csrf_token %}

                    <div id="text_error_detail" style="display: none;" class="alert alert-danger alert-dismissible fade show mb-0" role="alert">
                    </div>
                    <div class="mb-3 row">
                        <label for="description" class="col-md-4 col-form-label">Description:</label>
                        <div class="col-md-8">
                            <textarea class="form-control" rows="4" type="text" id="description" required></textarea>
                        </div>
                        
                    </div>
                    <div class="mb-3 mt-3 row">
                        <label for="sn" class="col-md-4 col-form-label">SN:</label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="sn" name="sn">
                        </div>
                    </div>
                    <div class="mb-3 mt-3 row">
                        <label for="qty" class="col-md-4 col-form-label">QTY:</label>
                        <div class="col-md-8">
                            <input type="text" class="form-control integer" id="qty"  name="qty">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="uom" class="col-md-4 col-form-label">UOM:</label>
                        <div class="col-md-8">
                            <select class="form-control uom-select" id="uom" name="uom" >
                                <option value="">Select UOM</option>
                                {% for uom in uoms %}
                                    <option value="{{uom.id}}">{{uom.name}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="unitprice" class="col-md-4 col-form-label">Unit Price:</label>
                        <div class="col-md-8">
                            <input class="form-control js-number" type="text" id="unitprice" >
                        </div>
                    </div>
                    
                    
                </form>
                <input type="hidden" id="scopeid" value="-1" />
            
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary waves-effect waves-light btn-sm btn_scopeadd">Add</button>
                
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!--file modal content -->
<div id="filemodal" class="modal fade" role="dialog" aria-labelledby="fileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="head_title_file">Add File</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <div class="modal-body" id="manage_file">
                <form class="needs-validation p-3" id="FileForm">
                    {% csrf_token %}

                    <div id="text_error_file" style="display: none;" class="alert alert-danger alert-dismissible fade show mb-0" role="alert">
                    </div>
                    
                    <div class="mb-3 mt-3 row">
                        <label for="fname" class="col-md-4 col-form-label">Name:</label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="fname"  name="fname" required>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label for="document" class="col-md-4 col-form-label">Document:</label>
                        <div class="col-md-8">
                            <input class="filestyle" data-buttonname="btn-primary" type="file" id="fdocument">
                        </div>
                    </div>
                </form>
                <input type="hidden" id="fileid" value="-1" />
            
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary waves-effect waves-light btn-sm btn_fileadd">Add</button>
                
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- Delete quotation modal content -->
<div id="deleteModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="delModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="delModalLabel">Delete Scope</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <div class="modal-body">
                <h5>Are you sure you want to delete this record?</h5>
                <input type="hidden" id="del_id" value="-1">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button id="del_confirm" type="button" class="btn btn-primary waves-effect btn-sm waves-light">OK</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- Delete quotation file modal content -->
<div id="deletefModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="delfModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="delModalLabel">Delete File</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <div class="modal-body">
                <h5>Are you sure you want to delete this record?</h5>
                <input type="hidden" id="delf_id" value="-1">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button id="del_fconfirm" type="button" class="btn btn-primary waves-effect btn-sm waves-light">OK</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
{% endblock %}
{% block scripts %}
<script src="{% static 'assets/libs/select2/js/select2.full.min.js' %}"></script>
<script src="{% static 'assets/libs/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %}"></script>
<script src="{% static 'assets/libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<!-- Responsive examples -->
<script src="{% static 'assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js' %}"></script>
<script src="{% static 'assets/libs/admin-resources/bootstrap-filestyle/bootstrap-filestyle.min.js' %}"></script>
<!-- plugin js -->
<!-- <script src="{% static 'assets/libs/moment/min/moment.min.js' %}"></script> -->
<!-- Handsontable -->
{% comment %} <script href="{% static 'assets/handsontable/handsontable.full.min.js' %}"></script> {% endcomment %}
<script>
    
    $( document ).ready(function() {
        var aaaaa = [
            ['', 'Ford', 'Tesla', 'Toyota', 'Honda'],
            ['2017', 10, 11, 12, 13],
            ['2018', 20, 11, 14, 13],
            ['2019', 30, 15, 12, 13]
        ];
        var container = document.getElementById('example');
        var hot = new Handsontable(container, {
            height: 'auto',
            stretchH: 'all',
            autoWrapRow: true,
            colHeaders: true,
            minSpareRows: 1,
            dropdownMenu: true,
            contextMenu: ['row_above', 'row_below', 'remove_row', 'undo', 'redo'],
            licenseKey: 'non-commercial-and-evaluation',
        });
        Handsontable.dom.addEvent(load, 'click', () => {
            hot.loadData(aaaaa);
        });
        Handsontable.dom.addEvent(save, 'click', () => {
            // save all cell's data
            console.log("=========", hot.getData())
        });
    });

    var curdate = moment(new Date()).format("D MMM, YYYY");
    $("#sdate").val(curdate);
    $("#text_error").hide();
    $("#scopedatatable").DataTable({
        "aaSorting": [[ 0, "desc" ]],
        searching: true, 
        ordering: false,
        paging: false, 
        info: false,
        //dom: "<'row'<'col-sm-6'B><'col-sm-6'f>>" +
            //"<'row'<'col-sm-12'tr>>" +
            //"<'row'<'col-sm-2 text-start'i><'col-sm-2 mt-2 text-start'l><'col-sm-8 mt-2'p>>",
        });
    $("#newSearchPlace").html($("#scopedatatable_filter"));
    $("#filedatatable").DataTable({
        "aaSorting": [[ 0, "desc" ]],
        searching: false,
        ordering: false, 
        paging: false, 
        info: false,
        // dom: "<'row'<'col-sm-6'B><'col-sm-6'f>>" +
        //     "<'row'<'col-sm-12'tr>>" +
        //     "<'row'<'col-sm-2 text-start'i><'col-sm-2 mt-2 text-start'l><'col-sm-8 mt-2'p>>",

    });
    $("#newfilePlace").html($("#filedatatable_filter"));
    $('#quotcancel').hide();
    $("#QuotationDetailForm input").prop("disabled", true);
    $("#QuotationDetailForm textarea").prop("disabled", true);
    $('.select2').prop('disabled', true);
    $('#quotsave').prop('disabled', true);
    $('#quotsaveandoverwrite').prop('disabled', true);
    if($("#po_no").val() == "") {
        $("#qtt_status").prop('disabled', true);
    }
    // $("#po_no").on("keyup", function(event) {
    //     if($("#po_no").val() == "") {
    //         $("#po_no_valid").css("display", "block"); 
    //         $("#qtt_status").prop('disabled', true);
    //     } else {
    //         $("#po_no_valid").css("display", "none"); 
    //         $("#qtt_status").prop('disabled', false);
    //     }
    // });
    $("#po_no").on("click", function(event) {
        if($("#po_no").val() == "") {
            $("#po_no_valid").css("display", "block"); 
            $("#qtt_status").prop('disabled', true);
        } else {
            $("#po_no_valid").css("display", "none"); 
            $("#qtt_status").prop('disabled', false);
        }
    });
    $(".custom-select").prop('disabled', false);
    $(".select2").select2({width: '100%'});
    $(".uom-select").select2({width: '100%', dropdownParent: $("#manage_info")});
    $(".js-number").keydown(function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && event.keyCode == 190)
            event.preventDefault(); 
    });
    $("#company_name").on('change', function(e){
        var company = $("#company_name").val();
        if(company != ""){
            $.ajax({
                headers: { "X-CSRFToken": '{{csrf_token}}' },
                url: '{% url "ajax_check_quotation_company" %}',
                data: {
                    company: $("#company_name").val()
                },
                type: 'POST',
                success: function (data) {
                    $("#address").val(data['address'] + " " + data['unit'] + " " + data['country'] + " " + data['postalcode']);                   
                }
            });
        }
    });
    $(".integer").keypress(function (e){
        var charCode = (e.which) ? e.which : e.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
    });
    $("#quotupdate").on('click', function(e){
        $("#QuotationDetailForm input").prop("disabled", false);
        $("#QuotationDetailForm textarea").prop("disabled", false);
        $('.select2').prop('disabled', false);
        $('#quotsave').prop('disabled', false);
        $( "#qtt_id" ).prop( "disabled", true );
        $('#quotsaveandoverwrite').prop('disabled', false);
        if ($("#qtt_status").val() == "Awarded") {
            $('#sale_type').prop('disabled', true);
        } else {
            $('#sale_type').prop('disabled', false);
        }
        // if($("#po_no").val() == "") {
        //     $("#qtt_status").prop('disabled', true);
        // } else {
        //     $("#qtt_status").prop('disabled', false);
        // }
        
        $('#quotcancel').show();
        $('#quotupdate').hide();
    });
    $("#quotcancel").on('click', function(e){
        $("#QuotationDetailForm input").prop("disabled", true);
        $("#QuotationDetailForm textarea").prop("disabled", true);
        $('select').prop('disabled', true);
        $('#quotsave').prop('disabled', true);
        $( "#qtt_id" ).prop( "disabled", true );
        $('#quotsaveandoverwrite').prop('disabled', true);
        if ($("#qtt_status").val() == "Awarded") {
            $('#sale_type').prop('disabled', true);
        } else {
            $('#sale_type').prop('disabled', false);
        }
        
        $("#qtt_status").val(`{{quotation.qtt_status}}`);
        $("#qtt_status").trigger('change');
        $("#po_no_valid").css("display", "none"); 
        $('#quotcancel').hide();
        $('#quotupdate').show();
    });
    $("#scopeadd").on('click', function(e) {
        $("#head_title_item").html('Add Item');
        $("#qty").val('');
        $("#uom").val('');
        $("#sn").val('');
        $("#unitprice").val('');
        $("#description").val('');
        $("#scopeid").val('-1');
        $("#scopemodal").modal('show')
    });

    $("#qtt_status").on('change',function(e){

        if ($("#qtt_status").val() == "Awarded") {
            $('#sale_type').prop('disabled', true);
        } else {
            $('#sale_type').prop('disabled', false);
        }
        if($("#po_no").val() == "") {
            $('#qtt_status').prop('disabled', true);
            $("#po_no_valid").css("display", "block"); 
        } else {
            $('#qtt_status').prop('disabled', false);
            $("#po_no_valid").css("display", "none"); 
        }
    });
    $("#quotsave").on('click', function(e){
        $('#QuotationDetailForm').parsley().validate();
        if ($('#QuotationDetailForm').parsley().validate() === false) {         
            event.preventDefault();
            event.stopPropagation();
            return;
        } else {
            $.ajax({
                headers: { "X-CSRFToken": '{{csrf_token}}' },
                url: '{% url "ajax_update_quotation" %}',
                data: {
                    company_name: $("#company_name").val(),
                    address: $("#address").val(),
                    contact_person: $("#contact_person").val(),
                    email: $("#email").val(),
                    tel: $("#tel").val(),
                    fax: $("#fax").val(),
                    re: $("#qre").val(),
                    note: $("#note").val(),
                    qtt_id: $("#qtt_id").val(),
                    sale_type: $("#sale_type").val(),
                    date: formatDate($("#date").val()),
                    qtt_status: $("#qtt_status").val(),
                    estimated_mandays: $("#estimated_mandays").val(),
                    sale_person: $("#sale_person").val(),
                    po_no: $("#po_no").val(),
                    validity: $("#quo_validity").val(),
                    material_lead_time: $("#material_lead_time").val(),
                    terms: $("#quo_terms").val(),
                    quotid: `{{quote}}`,
                },
                type: 'POST',
                success: function (data) {
                    if(data.status=="Success"){
                        $("#text_error").hide();
                        location.reload();
                    } else {
                        $("#text_error").html(data.messages);
                        $("#text_error").show();
                    }
                }
            });
        }
    });
    $("#quotsaveandoverwrite").on('click', function(e){
        $('#QuotationDetailForm').parsley().validate();
        if ($('#QuotationDetailForm').parsley().validate() === false) {         
            event.preventDefault();
            event.stopPropagation();
            return;
        } else {
            $.ajax({
                headers: { "X-CSRFToken": '{{csrf_token}}' },
                url: '{% url "ajax_update_quotation_override" %}',
                data: {
                    company_name: $("#company_name").val(),
                    address: $("#address").val(),
                    contact_person: $("#contact_person").val(),
                    email: $("#email").val(),
                    tel: $("#tel").val(),
                    fax: $("#fax").val(),
                    re: $("#qre").val(),
                    note: $("#note").val(),
                    qtt_id: $("#qtt_id").val(),
                    sale_type: $("#sale_type").val(),
                    date: formatDate($("#date").val()),
                    qtt_status: $("#qtt_status").val(),
                    estimated_mandays: $("#estimated_mandays").val(),
                    sale_person: $("#sale_person").val(),
                    validity: $("#quo_validity").val(),
                    po_no: $("#po_no").val(),
                    terms: $("#quo_terms").val(),
                    quotid: `{{quote}}`,
                },
                type: 'POST',
                success: function (data) {
                    if(data.status=="Success"){
                        $("#text_error").hide();
                        location.reload();
                    } else {
                        $("#text_error").html(data.messages);
                        $("#text_error").show();
                    }
                }
            });
        }
    });
    function formatDate(date) {
        var d = new Date(date),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2) 
            month = '0' + month;
        if (day.length < 2) 
            day = '0' + day;

        return [year, month, day].join('-');
    }
    $(".btn_scopeadd").on('click', function(e){
        $('#ScopeForm').parsley().validate();
        if ($('#ScopeForm').parsley().validate() === false) {         
            event.preventDefault();
            event.stopPropagation();
            return;
        } else {
            $.ajax({
                headers: { "X-CSRFToken": '{{csrf_token}}' },
                url: '{% url "ajax_add_scope_detail" %}',
                data: {
                    qty: $("#qty").val(),
                    uom: $("#uom").val(),
                    sn: $("#sn").val(),
                    description: $("#description").val(),
                    unitprice: $("#unitprice").val(),
                    scopeid: $("#scopeid").val(),
                    quotationid: `{{quote}}`,
                    qtt_id: $("#qtt_id").val(),
                },
                type: 'POST',
                success: function (data) {
                    if(data.status=="Success"){
                        $("#text_error_detail").hide();
                        location.reload();
                    } else {
                        $("#text_error_detail").html(data.messages);
                        $("#text_error_detail").show();
                    }
                }
            });
        }
    });
    function updatescope(id){
        $("#scopeid").val(id);
        $("#head_title_item").html('Update Item');
        $(".btn_scopeadd").html('Update');
        $.ajax({
            headers: { "X-CSRFToken": '{{csrf_token}}' },
            url: '{% url "ajax_get_scope" %}',
            data: {
                scopeid: $("#scopeid").val(),
            },
            type: 'POST',
            success: function (data) {
                up_data = JSON.parse(data)
                $("#sn").val(up_data.sn);
                $("#qty").val(up_data.qty);
                $("#uom").val(up_data.uom);
                $("#uom").trigger("change");
                $("#unitprice").val(up_data.unitprice);
                $("#description").val(up_data.description);
            }
        });
        $("#scopemodal").modal('show');
    };
    function deletescope(id) {
        $("#del_id").val(id);
        $("#deleteModal").modal('show');
    }
    $("#del_confirm").on('click', function(event){
        $.ajax({
            headers: { "X-CSRFToken": '{{csrf_token}}' },
            url: '{% url "ajax_delete_scope" %}',
            data: {
                'scopeid': $("#del_id").val(),
            },
            type: 'POST',
            success: function (data) {
                if (data.status == "ok") {
                    location.reload(); 
                }
            }
        });
        $('#deletModal').modal('hide');
    });
    // function readFile(input) {
    //     if (input.files && input.files[0]) {
    //         var reader = new FileReader();

    //         reader.onload = function (e) {
    //             $(input).parents('.avatar-input').find('.signature-img').attr('src', e.target.result);
    //         };

    //         reader.readAsDataURL(input.files[0]);
    //     }
    // }
    // $('.avatar-file-picker').on('change', function () {
    //      readFile(this);
    // });
    $(".signature_save").on('click', function(e){
        var form = $("#SignatureForm");
        if (form[0].checkValidity() === false) {
            event.preventDefault()
            event.stopPropagation()
            form.addClass('was-validated');
            return;
        } 
        var sign_data = $("#signature").prop('files')[0];
        var comsign_data = $("#companystamp").prop('files')[0];
        var form_data = new FormData();
        form_data.append('signature', sign_data);
        form_data.append('companycamp', comsign_data);
        form_data.append('sname', $("#sname").val());
        form_data.append('sdate', formatDate($("#sdate").val()));
        form_data.append('quotationid', `{{quote}}`);
        $.ajax({
            headers:{ 'X-CSRFToken': "{{csrf_token}}" },
            url: "{% url 'ajax_save_signature' %}",
            type: 'POST',
            data: form_data,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                if(data.status=="Success"){
                    location.reload();
                } else {

                }
                
                
            }
        });
    });
    function updatefile(id){
        $("#fileid").val(id);
        $("#head_title_file").html('Update File');
        $(".btn_fileadd").html('Update');
        $.ajax({
            headers: { "X-CSRFToken": '{{csrf_token}}' },
            url: '{% url "ajax_get_file" %}',
            data: {
                fileid: $("#fileid").val(),
            },
            type: 'POST',
            success: function (data) {
                up_data = JSON.parse(data)
                $("#fname").val(up_data.name);
                $('.bootstrap-filestyle').find('input.form-control').val(up_data.document);
            }
        });
        $("#filemodal").modal('show')
    }
    $("#fileadd").on('click', function(e){
        $("#head_title_file").html("Add File");
        $("#fname").val('');
        $("#fileid").val('-1');
        $("#filemodal").modal('show');
    });
    $(".btn_fileadd").on('click', function(e){
        $('#FileForm').parsley().validate();
        if ($('#FileForm').parsley().validate() === false) {         
            event.preventDefault();
            event.stopPropagation();
            return;
        } else {
            var document_data = $("#fdocument").prop('files')[0];
            var form_data = new FormData();
            form_data.append('document', document_data);
            form_data.append('fname', $("#fname").val());
            form_data.append('fileid', $("#fileid").val());
            form_data.append('quotationid', `{{quote}}`);
            $.ajax({
                headers:{ 'X-CSRFToken': "{{csrf_token}}" },
                url: "{% url 'ajax_add_qfile' %}",
                type: 'POST',
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    if(data.status=="Success"){
                        location.reload();
                    } 
                }
            });
        }
        
    });
    function deletefile(id) {
        $("#delf_id").val(id);
        $("#deletefModal").modal('show');
    }
    $("#del_fconfirm").on('click', function(event){
        $.ajax({
            headers: { "X-CSRFToken": '{{csrf_token}}' },
            url: '{% url "ajax_delete_qfile" %}',
            data: {
                'fileid': $("#delf_id").val(),
            },
            type: 'POST',
            success: function (data) {
                if (data.status == "ok") {
                    location.reload(); 
                }
            }
        });
        $('#deletefModal').modal('hide');
    });
    
    $('a[role=tab]').click(function(){
        if (this.id == "qdetailtab") {
            localStorage.setItem("quotationitem", '1');
        } else if (this.id == "qitemtab") {
            localStorage.setItem("quotationitem", '2');
        } else if (this.id == "qfiletab") {
            localStorage.setItem("quotationitem", '3');
        } 
    });
    var tabactive = localStorage.getItem("quotationitem");
    if (tabactive == null || tabactive == '1') {
        $("#qdetailtab").addClass('active');
        $("#qitemtab").removeClass('active');
        $("#qfiletab").removeClass('active');

        $("#qdetails").addClass('active');
        $("#qitems").removeClass('active');
        $("#qfiles").removeClass('active');

    } else if (tabactive == '2') {
        $("#qdetailtab").removeClass('active');
        $("#qitemtab").addClass('active');
        $("#qfiletab").removeClass('active');

        $("#qdetails").removeClass('active');
        $("#qitems").addClass('active');
        $("#qfiles").removeClass('active');
    } else if (tabactive == '3'){
        $("#qdetailtab").removeClass('active');
        $("#qitemtab").removeClass('active');
        $("#qfiletab").addClass('active');

        $("#qdetails").removeClass('active');
        $("#qitems").removeClass('active');
        $("#qfiles").addClass('active');
    }
    $(".js-number").keydown(function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46) {

        } else {
            event.preventDefault();
        }

    });
</script>
{% endblock %}
